// Generated by CoffeeScript 2.3.2
(function() {
  var checkPath, checkUri, exec, readline, red;

  checkPath = require('../../utils/checkPath');

  readline = require('readline');

  ({exec} = require('child_process'));

  ({red} = require('chalk'));

  // check uri
  checkUri = function(uri) {
    var base_check;
    base_check = /^((ht|f)tps?):\/\/([\w\-]+(\.[\w\-]+)*\/)*[\w\-]+(\.[\w\-]+)*\/?(\?([\w\-\.,@?^=%&:\/~\+#]*)+)?/;
    return base_check.test(uri);
  };

  module.exports = function(req, res) {
    var localpath, uri;
    ({uri, localpath} = req.body);
    if (checkUri) {
      return checkPath(localpath).then(function() {
        return exec(`git clone ${uri}`, {
          cwd: localpath
        }, function(err, stdout, stdin) {
          console.log(stdin.toString());
          if (err) {
            process.stdout.write(red(err));
            res.send({
              code: 0,
              err_msg: err.toString()
            });
            return res.end();
          } else {
            res.send({
              code: 1,
              srv_msg: stdin.toString()
            });
            return res.end();
          }
        });
      }).catch(function(err) {
        /*
            {code:0, err_msg:没有这个目录}
        */
        return res.send(err);
      });
    } else {
      return res.send({
        code: 0,
        err_msg: 'uri地址格式不正确'
      });
    }
  };

}).call(this);

//# sourceMappingURL=clone.js.map
